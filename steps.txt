// AWS DevOps Demo - Commands & Flows

AWS Authentication → Use AWS SSO or aws-vault for secure access aws sso login --profile kunalshrivastava

OR
aws-vault exec kunalshrivastava --duration=8h aws sts get-caller-identity # quick identity check → Always verify: aws sts get-caller-identity

Practice 1 – VPC + CloudFormation (IaC Best Practices) cd "C:\kunal\cloudthat training devops\scope\vpc"

aws --version aws cloudformation validate-template --template-body file://Enterprise_VPC_Complete_working.yaml

Create stack
aws cloudformation create-stack --stack-name LabVPC-Demo
--parameters ParameterKey=InstanceType,ParameterValue=t2.micro
--template-body file://Enterprise_VPC_Complete_working.yaml
--disable-rollback aws cloudformation create-stack --stack-name LabVPC-Demo --parameters ParameterKey=InstanceType,ParameterValue=t2.micro --template-body file://Enterprise_VPC_Complete_working.yaml --disable-rollback

Monitor (repeat until CREATE_COMPLETE)
aws cloudformation describe-stacks --stack-name LabVPC-Demo --query "Stacks[0].StackStatus" --output text

Drift detection
aws cloudformation describe-stack-resource-drifts --stack-name LabVPC-Demo

ChangeSet for safe updates (Check safety!)
aws cloudformation create-change-set --stack-name LabVPC-Demo --change-set-name ReviewChanges --template-body file://Enterprise_VPC_Complete_working.yaml

aws cloudformation describe-change-set --stack-name LabVPC-Demo --change-set-name ReviewChanges

Execute only if approved
aws cloudformation execute-change-set --stack-name LabVPC-Demo --change-set-name ReviewChanges
Cleanup
aws cloudformation delete-stack --stack-name LabVPC-Demo
Practice 2 – AWS CodeDeploy (EC2 + Agent + Blue/Green potential) → Tag EC2: Name = my-web-server → IAM role: AmazonSSMManagedInstanceCore attached (must for SSM)

cd "C:\kunal\cloudthat training devops\scope\codedeploy"

Install CodeDeploy agent via SSM (tag-based – safe)
aws ssm send-command --region ap-south-1 --document-name "AWS-RunShellScript"
--targets "Key=tag:Name,Values=my-web-server"
--parameters "commands=yum install -y ruby wget,cd /tmp,wget https://aws-codedeploy-ap-south-1.s3.ap-south-1.amazonaws.com/latest/install,chmod +x install,./install auto,systemctl enable codedeploy-agent || true,systemctl start codedeploy-agent || true"
--comment "Install CodeDeploy Agent" --output text

aws ssm send-command --document-name "AWS-RunShellScript" --targets "Key=tag:Name,Values=my-web-server" --parameters "commands=yum install -y ruby wget,cd /tmp,wget https://aws-codedeploy-ap-south-1.s3.ap-south-1.amazonaws.com/latest/install,chmod +x install,./install auto,systemctl enable codedeploy-agent || true,systemctl start codedeploy-agent || true" --comment "Install CodeDeploy Agent" --output text

Check command status (get CommandId from above output)
aws ssm list-command-invocations --command-id --details --region ap-south-1

Prepare artifact
aws s3 mb s3://web-cd-artifacts-ks-demo --region ap-south-1 # unique name aws deploy push --application-name my-web-server-app --source web --s3-location s3://web-cd-artifacts-ks-demo/web.zip --region ap-south-1

Deploy
aws deploy create-deployment --application-name my-web-server-app
--s3-location bucket=web-cd-artifacts-ks-demo,key=web.zip,bundleType=zip
--deployment-group-name my-web-server-app-dg --region ap-south-1

Monitor in console or CLI
aws deploy get-deployment --deployment-id --region ap-south-1

→ Talking point: "If agent fails → check SSM role, VPC endpoints, yum repos. For prod use blue/green."

Practice 3 – CodePipeline (Source → Build → Deploy) cd "C:\kunal\cloudthat training devops\scope\codepipeline"

aws s3 mb s3://web-codepipeline-artifacts-ks-demo --region ap-south-1 aws s3 cp web.zip s3://web-codepipeline-artifacts-ks-demo/web.zip

→ Open AWS Console → CodePipeline → Check pipeline stages (Source: S3/CodeCommit, Build: CodeBuild, Deploy: CodeDeploy/ECS)

Practice 4 – AWS SAM (Serverless) cd "C:\kunal\cloudthat training devops\scope\aws sam\sam-app"

Edit template.yaml or code → git add/commit/push
git status git commit -m "Update Lambda function - added feature X" git push

→ Check pipeline trigger in CodePipeline or SAM pipeline → Check CloudFormation / Lambda output for endpoint URL

Talking point: "SAM extends CloudFormation for serverless – easy local testing with sam local invoke."

Practice 5 – ECS / Fargate Pipeline cd "C:\kunal\cloudthat training devops\scope\ecs ecr fargate\MY_WEB_APP_DEMO"

Change Dockerfile or app code → commit & push
git add . git commit -m "Update container image version" git push

→ Check ECR repo (image pushed), CodePipeline stages, ECS service update → ALB DNS: my-webapp-alb-531517662.ap-northeast-1.elb.amazonaws.com
